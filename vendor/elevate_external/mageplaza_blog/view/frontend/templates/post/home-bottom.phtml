<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_Blog
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

/** @var \Mageplaza\Blog\Block\Frontend $block */

?>


<?php $postCollection = $block->getPostCollection(); ?>
<div class="blog-home homepage-block">

    <?php
    $url = 'http://' . $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];

    ?>

    <div class="row latest-posts">


        <?php $i = 1;
        // TODO: Make Admin Selection
        $category_one_id = 10; //(will poss not be this on live!)
        $category_two_id = 9; //buying guides (might change!)
        $max_number_of_featurecat_articles_to_show = 3;

        $cat_one_post_collection = $block->getCategoryPostCollection($category_one_id);
        $cat_two_post_collection = $block->getCategoryPostCollection($category_two_id);

        $main_post_collection = [];

        $first_post_collection = [];
        $second_post_collection = [];

        ?>
        <?php foreach ($postCollection as $post) {
            $post_name = $post->getName();
            $post_url = str_replace('blog/post', 'blog', str_replace('.html', '', $post->getUrl()));
            $post_image = '/media/mageplaza/blog/post/' . $post->getImage();//$block->resizeImage($post->getImage(), '1200px');
            $post_info = $block->getPostInfo($post);

            $description_length = 100;

            if (!empty($post->getShortDescription())) {
                $post_description = $block->maxShortDescription($post->getShortDescription());
            } else {
                $post_description = $block->maxShortDescription(mb_strimwidth(strip_tags($post->getPostContent()), 0, $description_length, '...'));
            }

            if ($i == 1) {
                $main_post_collection[] = [
                    'post_name'        => $post_name,
                    'post_url'         => $post_url,
                    'post_image'       => $post_image,
                    'post_info'        => $post_info,
                    'post_description' => $post_description
                ];
            }
            //top block
            if ($i > 1 && $i <= 6) {
                $first_post_collection[] = [
                    'post_name'        => $post_name,
                    'post_url'         => $post_url,
                    'post_image'       => $post_image,
                    'post_info'        => $post_info,
                    'post_description' => $post_description
                ];
            }

            //rest of posts
            if ($i > 6) {
                $first_post_collection[] = [
                    'post_name'        => $post_name,
                    'post_url'         => $post_url,
                    'post_image'       => $post_image,
                    'post_info'        => $post_info,
                    'post_description' => $post_description
                ];
            }

            $imageZoom = false;
            if ($i == 1) {
                $imageZoom = true;
            }

            $i++;
        }
        ?>
        <?php
        $cat_one_info = $this->getCategoryInfo($category_one_id);

        $category_title = $cat_one_info['name'];
        $category_url_key = $cat_one_info['url_key'];

        ?>
        <div id="blog-feature-category-one" class="blog-feature-category col-md-12">

            <div class="section-title-outer">
                <a href="/blog/<?= $category_url_key ?>">
                    <div class="section-title-inner">
                        <div class="section-title"><?= $category_title ?></div>
                        <div class="read-all-link">View more <?= $category_title ?></div>
                    </div>
                </a>
            </div>

            <div class="blog-feature-row row">


                <?php
                $cat_one_count = 1;

                foreach ($cat_one_post_collection as $post) {
                    if ($cat_one_count > $max_number_of_featurecat_articles_to_show) {
                        break;
                    }
                    $post_name = $post->getName();
                    $post_url = str_replace('blog/post', 'blog', str_replace('.html', '', $post->getUrl()));
                    $post_image = '/media/mageplaza/blog/post/' . $post->getImage();//$block->resizeImage($post->getImage(), '1200px');

                    ?>
                    <div class="featured-cat-article-outer">
                        <a href="<?= $post_url ?>">
                            <div class="featured-cat-article-img">
                                <img src="<?= $post_image ?>" alt="<?= $post_name; ?>" class="img-responsive"/></div>
                            <div class="featured-cat-articlename"><?= $post_name; ?></div>
                        </a>
                    </div>
                    <?php
                    $cat_one_count++;
                } ?>
            </div>
        </div>
        <div id="blog-feature-category-two" class="blog-feature-category col-md-12">
            <?php
            $cat_two_count = 1;

            $cat_two_info = $this->getCategoryInfo($category_two_id);

            $category_title = $cat_two_info['name'];
            $category_url_key = $cat_two_info['url_key'];

            ?>
            <div class="section-title-outer">
                <a href="/blog/<?= $category_url_key ?>">
                    <div class="section-title-inner">
                        <div class="section-title"><?= $category_title ?></div>
                        <div class="read-all-link"><?= $category_title ?></div>
                    </div>
                </a>
            </div>
            <div class="blog-feature-row row">

                <?php
                foreach ($cat_two_post_collection as $post) {
                    if ($cat_two_count > $max_number_of_featurecat_articles_to_show) {
                        break;
                    }
                    $post_name = $post->getName();
                    $post_url = str_replace('blog/post', 'blog', str_replace('.html', '', $post->getUrl()));
                    $post_image = '/media/mageplaza/blog/post/' . $post->getImage();//$block->resizeImage($post->getImage(), '1200px');

                    ?>
                    <div class="featured-cat-article-outer">
                        <a href="<?= $post_url ?>">
                            <div class="featured-cat-article-img">
                                <img src="<?= $post_image ?>" alt="<?= $post_name; ?>" class="img-responsive"/></div>
                            <div class="featured-cat-articlename"><?= $post_name; ?></div>
                        </a>
                    </div>
                    <?php
                    $cat_two_count++;
                } ?>
            </div>
        </div>

<?php
      $url = 'http://' . $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];

      if (strpos($url,'posturite') !== false)
      {

      $latest_posts_title = __('Latest Posts');

      ?>
          <?php } ?>
      <style>
      
        .latest-posts .col-md-12 {
          display: flex;
          flex-wrap: wrap;
        }
        .grid-item {
          box-shadow: none !important;
          border-bottom: 0px solid gray;
          margin-bottom: 25px;
          border: 0px solid #ccc !important;
          align-items: stretch;
          flex-grow: 1;
          width: 25.0%;
        }
        .evblog .post-list-item {
          box-shadow: none !important;
          border-bottom: 1px solid gray;
          margin-bottom: 25px;
          border: 1px solid #eee;
          padding: 0 !important;
          position: relative;
          height: 100%;
          border-radius: 10px;
          overflow: hidden;
        }
        .featured-image.left {
          overflow: hidden;
          height: 210px;
        }
        img.wp-main-featured-img {
          height: auto !important;
        }
        .post-title {
          color: black;
        }
        .right-content .post-title h2 {
          font-size: 15px !important;
        }
        .evblog .post-list-item {

          margin: 13px;
        }
        .right-content {
          padding: 5px 30px;
        }
        .post-short-description {
          font-size: 1rem;
          max-width: 100%;
          color: #868686;
          font-size: 12px;
        }
        .post-short-description:hover {
          text-decoration:none;
        }
        
        @media only screen and (max-width: 991.98px)  {
 .grid-item {
    width: 100%;
}
}
      </style>

  


            <div class="col-md-12">
                <div class="section-title-outer">

                    <div class="section-title-inner">
                        <div class="section-title">More Posts</div>
                       <!-- <div class="read-all-link">View All Posts</div>-->
                    </div>

                </div>
                <?php

                foreach ($first_post_collection as $post) { ?>


                    <div class="grid-item">
                        <div class="post-list-item">
                            <div class="post-entry entry<?php if ($post['post_image']): ?> post-entry-with-image<?php endif; ?>">
                                <a class="row" href="<?= $post['post_url'] ?>" title="<?= $post['post_name'] ?>">
                                    <div class="left-image">
                                        <div class="featured-image left">
                                            <img class="wp-main-featured-img" src="<?= $post['post_image'] ?>" alt="<?= $post['post_name'] ?>"/>
                                        </div>
                                    </div>
                                    <div class="right-content">
                                        <div class="post-title"><h2><?= $post['post_name'] ?></h2></div>
                                        <div class="post-details"><?= $post['post_info']; ?></div>
                                        <div class="post-short-description"><?= $post['post_description']; ?></div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                <?php } ?>
            </div>



    </div>























