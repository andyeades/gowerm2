<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_Blog
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

/** @var \Mageplaza\Blog\Block\Sidebar\MostView $block */

$posts = $block->getMostViewPosts();
$postsRecent = $block->getRecentPost();


$show_popular_posts = 0; //TODO:: Make Admin Toggle?
$show_sidebar_post_date = 0;
?>
<style>

  .mp-sidebar #tab-content-mostview .post-left img {

    max-height: 72px;

  }
</style>

<?php $url = $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];

$latest_posts_title = '<i class="fa fa-star" aria-hidden="true"></i>'.__('Latest Posts');


if (strpos($url,'posturite') !== false)
{

    $latest_posts_title = __('Latest Posts');

    ?>
  <style>
    .post-right span {
            color: black;
          }
    .post-right span:hover {
    text-decoration: underline;
    }
    .evblog #page-main-outer ul.menu-categories a.list-categories {
      margin-left: 8px;
      color: black;
    }
    .evblog #page-main-outer ul.menu-categories a.list-categories:hover {
      text-decoration: underline;
    }
    .post-list-content {
      margin-bottom: 50px;
    }
    .evblog .sidebar .section-title-outer {
      margin: 1rem 0 0rem 0;
    }
    .mp-sidebar #tab-content-mostview .post-left img {

      max-height: 72px;

    }

    .page-title-wrapper {
      /* position: absolute;*/
      /* background-color: #ffffffc9;*/
      /* top: 0;*/
      margin-bottom: 40px;
    }
    .evblog #page-main-outer h1.page-title {

      color: black;
    }
    .column.main {
     /* position: relative;*/
    }
    .post-view-image img {
      width: 100%;
    }
  </style>

<?php } ?>
<div class="mp-sidebar product info detailed">
    <div class="product data items" data-mage-init='{"tabs":{"openedState":"active"}}'>

        <div class="data item title" data-role="collapsible" id="tab-label-mostview">
            <a class="data switch" tabindex="-1" data-toggle="switch" id="tab-label-mostview-title">
                <div class="section-title-outer">
                    <div class="section-title-inner">
                        <div class="section-title">
                          <?php echo $latest_posts_title; ?>
                        </div>
                    </div>
                </div>
                <div></div>
            </a>
        </div>
        <div class="data item content" id="tab-content-mostview" data-role="content">
            <?php if ($postsRecent->getSize()) : ?>
                <?php foreach ($postsRecent as $post) : ?>
                    <div class="list-post-tabs" href="<?= str_replace('/post', '', $post->getUrl()) ?>">
                        <div class="post-left">
                            <a href="<?= str_replace('/post', '', $post->getUrl()) ?>">
                                <img class="img-responsive"
                                     src="<?= $block->resizeImage($post->getImage(), '100x') ?>">
                            </a>
                        </div>
                        <div class="post-right">
                            <a href="<?= str_replace('/post', '', $post->getUrl()) ?>"><span><?= $post->getName() ?></span></a>
                            <?php
                            //Todo: Make Admin Toggle

                            if ($show_sidebar_post_date != 0) { ?>
                                <span class="create-at">
                                <?= $post->getPublishDate() ? $block->getDateFormat($post->getPublishDate()) : ''; ?>
                            </span>
                            <?php } ?>

                        </div>
                        <div class="mp-clear"></div>
                    </div>
                <?php endforeach; ?>
            <?php else : ?>
                <div class="mostview-nopost"><?= __('No Posts'); ?></div>
            <?php endif; ?>
        </div>


        <?php
        // Popular Posts - Make admin Toggle?
        if ($show_popular_posts != 0) { ?>




         <div class="data item title" data-role="collapsible" id="tab-label-popular">
            <a class="data switch" tabindex="-1" data-toggle="switch" id="tab-label-popular-title">
                <div><?= __('Popular') ?></div>
    </a>
</div>
<div class="data item content" id="tab-content-popular" data-role="content">
    <?php if ($posts->getSize()) : ?>
        <?php foreach ($posts as $post) : ?>
            <div class="list-post-tabs">
                <div class="post-left">
                    <a href="<?= str_replace('/post', '', $post->getUrl()) ?>">
                        <img class="img-responsive"
                             src="<?= $block->resizeImage($post->getImage(), '100x'); ?>">
                    </a>
                </div>
                <div class="post-right">
                    <a href="<?= str_replace('/post', '', $post->getUrl()) ?>"><span><?= $post->getName() ?></span></a>
                    <span class="create-at">
                                <?= $post->getPublishDate() ? $block->getDateFormat($post->getPublishDate()) : ''; ?>
                            </span>
                </div>
                <div class="mp-clear"></div>
            </div>
        <?php endforeach; ?>
    <?php else : ?>
        <div class="mostview-nopost"><?= __('No Posts'); ?></div>
    <?php endif; ?>
</div>

       <?php }
?>

</div>
</div>
<script>
    require([
        'jquery'
    ], function ($) {
        $("#popular-tab").click(function () {
            $("#tab-1").addClass('active');
            $("#tab-2").removeClass('active');
            $('#mostview').show();
            $('#mostrecent').hide();
        });
        $("#recent-tab").click(function () {
            $("#tab-1").removeClass('active');
            $("#tab-2").addClass('active');
            $('#mostview').hide();
            $('#mostrecent').show();
        });
    });
</script>
