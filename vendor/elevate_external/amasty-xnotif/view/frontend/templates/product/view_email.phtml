<?php
/**
 * @author Amasty Team
 * @copyright Copyright (c) 2020 Amasty (https://www.amasty.com)
 * @package Amasty_Xnotif
 */
?>
<?php
// @codingStandardsIgnoreStart
/** @var Magento\Framework\Url\Helper\Data $urlHelper */
$urlHelper = $this->helper(\Magento\Framework\Url\Helper\Data::class);
/** @var Amasty\Xnotif\Helper\Data $helper */
$helper = $this->helper(\Amasty\Xnotif\Helper\Data::class);
// @codingStandardsIgnoreEnd

$product = $helper->getOriginalProduct($block);
$productId = (int)$helper->getOriginalProduct($block)->getId();
$parentId = (int)$block->getData('parent_product_id');
$url = $block->escapeHtml($helper->getEmailUrl('stock'));
$product_type = $helper->getOriginalProduct($block)->getTypeId();

$style = 'style="display: none;"';

if ($product_type == "configurable") {
   // $style = 'style="display: none;"';
}
//if ($product_type == "simple") {
      /*
                $obj = \Magento\Framework\App\ObjectManager::getInstance();  
$stockRegistry = $obj->get('Magento\CatalogInventory\Api\StockRegistryInterface');
$stockitem = $stockRegistry->getStockItem($product->getId(),$product->getStore()->getWebsiteId());
$backorder_status = $stockitem->getBackorders();
$in_stock_status = $stockitem->getIsInStock();
$qty_in_stock = $stockitem->getQty();
    if(!$in_stock_status){
    $in_stock_status = 0;
    }
 echo "$backorder_status|$in_stock_status|$qty_in_stock<br>";      
       if( $in_stock_status == 0 && $qty_in_stock < 1){
        $style = '';
       }
      */ 
       
       
           $productSalable = $product->isSaleable();

    if ($productSalable) {            
  
        $style = 'style="display: none;"';
    } else {    
?>
     <style>
             .product-add-form {
    background-color: #fff !important; 
    border: solid 1px #fff;
    }
     </style>
<?php   
        $style = '';
    }         
//}
?>

<div class="amxnotif-block"  class="testing123445" data-action="<?= /* @noEscape */ $url; ?>" <?= $style; ?>>
    <form id="form-validate-stock" method="post" action="<?= /* @noEscape */ $url; ?>">
        <label for="notification-container-<?= /* @noEscape */ $productId ?>">
            
            <?= /* @noEscape */ __('Subscribe to back in stock notification') ?>
        </label>
        <div class="notification-container" id="notification-container-<?= /* @noEscape */ $productId ?>">
            <div class="input-fields fieldset">
                <input name="guest_email"
                       class="input-text amxnotif-guest-email"
                       id="amxnotif-guest-email-<?= /* @noEscape */ $productId ?>"
                       size="30"
                       type="email"
                       data-validate="{required:true, 'validate-email':true}"
                       placeholder="<?= $block->escapeHtml($helper->getPlaceholder()) ?>"
                />
                <input type="hidden" name="product_id"
                       value="<?= /* @noEscape */ $productId ?>"/>
                <input type="hidden" name="type" value="email"/>

                <?php if ($parentId):?>
                    <input type="hidden" name="parent_id"
                           value="<?= /* @noEscape */ $parentId ?>"/>
                <?php endif; ?>

                <input type="hidden" name="form_key" value="<?= $block->escapeHtmlAttr($helper->getFormKey()) ?>">
                <input type="hidden"
                       name="<?= /* @noEscape */ \Magento\Framework\App\Action\Action::PARAM_NAME_URL_ENCODED ?>"
                       value="<?= /* @noEscape */ $urlHelper->getEncodedUrl(); ?>"/>
                <?php if ($helper->isGDRPEnabled()): ?>
                    <div class="field required">
                        <input type="checkbox"
                               name="gdrp"
                               id="amxnotif-stock-gdrp-<?= /* @noEscape */ $productId ?>"
                               title="<?= $block->escapeHtml(__('GDRP')); ?>"
                               data-validate="{required:true}"
                               value="1">
                        <label class="label" for="amxnotif-stock-gdrp-<?= /* @noEscape */ $productId ?>">
                            <?= /* @noEscape */ $helper->getGDRPText(); ?>
                        </label>
                    </div>
                <?php endif; ?>
            </div>

            <div class="actions-toolbar amxnotif_guest_action">
                <div class="primary">
                    <button type="submit" class="action submit primary" style="background-color: #e66100;
    border-color: #e66100;">
                        <span><?= $block->escapeHtml(__('Subscribe')); ?></span>
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>



<script type="text/javascript">

    require([
        'jquery',
        "mage/mage",
        "mage/validation",
        'amnotification'
    ], function ($) {
        "use strict";
        console.log('test');
        $('#form-validate-stock').mage('validation');
    });
</script>
