<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
?>
<style>




</style>
<?php
$elevate_advanced_select = true;
// In your Javascript (external .js resource or <script> tag)

if($elevate_advanced_select){



?>




<?php } ?>
<?php /* @var $block \Magento\Bundle\Block\Catalog\Product\View\Type\Bundle\Option\Select */ ?>
<?php $_option      = $block->getOption(); ?>
<?php $_selections  = $_option->getSelections(); ?>
<?php $_default     = $_option->getDefaultSelection(); ?>
<?php list($_defaultQty, $_canChangeQty) = $block->getDefaultValues(); ?>
<div class="field option <?= ($_option->getRequired()) ? ' required': '' ?>">
    <label class="label" for="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>">
        <span><?= $block->escapeHtml($_option->getTitle()) ?></span>

      <?php

      $default_option_tooltip = $_option->getData('option_tooltip');
      if($default_option_tooltip != ''){
          ?>

          <a href="#"  title="<?php echo $block->escapeQuote(__('What is this?')) ?>" data-mage-init='{"tooltip": {"content": "<?php echo $default_option_tooltip ?>"}}'><span><i class="fa fa-info-circle fa-lg tooltipstered"></i></span></a>

      <?php
      }

      ?>

    </label>
    <div class="control">
        <?php if ($block->showSingle()) : ?>
            <?= /* @noEscape */ $block->getSelectionTitlePrice($_selections[0]) ?>
            <?= /* @noEscape */ $block->getTierPriceRenderer()->renderTierPrice($_selections[0]) ?>
            <input type="hidden"
                   class="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>  product bundle option"
                   name="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                   value="<?= $block->escapeHtmlAttr($_selections[0]->getSelectionId()) ?>"/>
        <?php else :?>

        <?php


        $default_option_text = $_option->getData('default_option_text');
        if($default_option_text == ''){
            $default_option_text = __('Choose a selection...');
        }
            $select_2_override_style = '';
if($elevate_advanced_select) {
    $select_2_override_style = 'display:none;';

}



            $option = '';
?>
 <script>
              var data_select = [];
          </script>

        <?php
        $output_array = [];
        if($elevate_advanced_select) {
            $option .= '<option value="" >'.$default_option_text.'</option>';
        } else {

            $option .= '<option value="" >'.$block->escapeHtml($default_option_text).'</option>';

        }
        foreach ($_selections as $_selection) :
//.($block->getSelectionTitlePriceHtml($_selection))."
            $output_array[] = "{
                  id: '".$_selection->getSelectionId()."',
                  text: '<div style=\"color:green\">enhancement</div>',
                  html: '".trim(json_encode("".$block->getSelectionTitlePriceHtml($_selection), JSON_NUMERIC_CHECK), '"')."',
                  title: 'enchancement'
              }";


//
        $option .= '<option data-evdata="bundle-option-'.$block->escapeHtmlAttr($_option->getId()).'" value="'.($_selection->getSelectionId()).'"';
        if ($block->isSelected($_selection)) { $option .=  ' selected="selected"'; }
        if (!$_selection->isSaleable()) { $option .=  ' disabled="disabled"'; }

        $option .= '>';
        $option .= $block->getSelectionTitlePriceHtml($_selection, false);
        $option .= '</option>'; ?>
        <?php endforeach;

echo '<textarea style="display:none;" id="data-bundle-option-'.$block->escapeHtmlAttr($_option->getId()).'">';
echo implode(',',$output_array);
 echo '</textarea>';

        ?>

            <select id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>"
                    name="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                    data-selector="bundle_option[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                    class="main_bundle_select bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?> product bundle option bundle-option-select change-container-classname"
                    style="<?= $select_2_override_style?>"
           <?php if ($_option->getRequired()) { echo 'data-validate = {required:true}'; } ?>>


                <?php

                echo $option;
                ?>




            </select>

        <?php
        if($elevate_advanced_select) {
        ?>
          <script>
              require(['jquery', 'select2'], function ($) {


                  //  var dataarray = $('#evdataarray').text();

                  //   var data = [dataarray];

                  function formatState (state) {
                  //    console.log("andy2");
                   //   console.log(state.element);
                      //  var myArray = jQuery.parseJSON(state.html);

                      // console.log(myArray);
                      if (!state.id) {
                          // console.log(state);
                          return state.text;
                      }


                      var $state = $(
                          '<span><span></span></span>'
                      );

                      // Use .text() instead of HTML string concatenation to avoid script injection issues
                      $state.find("span").text(state.id+' '+state.text+' ');
                      // $state.find("img").attr("src", baseUrl + "/" + state.element.value.toLowerCase() + ".png");

                      return $state;
                  };

                  $("#bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>").select2({
                       data: [<?php echo implode(',',$output_array) ?>],
                      minimumResultsForSearch: -1,
                       escapeMarkup: function(markup) {
                           return markup;
                       },
                       templateResult: function(data) {
                           return data.html;
                       },
                      //templateSelection: formatState
                      templateSelection: function(data) {
                           if(data.html == null){

                               return data.text;
                           }
                          return data.html;
                       }
                  })
                  $('.main_bundle_select').show();



              });
          </script>
        <? }
        ?>
            <div id="option-tier-prices-<?= $block->escapeHtmlAttr($_option->getId()) ?>" class="option-tier-prices">
                <?php foreach ($_selections as $_selection) : ?>
                    <div data-role="selection-tier-prices"
                         data-selection-id="<?= $block->escapeHtmlAttr($_selection->getSelectionId()) ?>"
                         class="selection-tier-prices">
                        <?= /* @noEscape */ $block->getTierPriceRenderer()->renderTierPrice($_selection) ?>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>
        <div class="nested" style="display:none;">
            <div class="field qty qty-holder">
                <label class="label" for="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-qty-input">
                    <span><?= $block->escapeHtml(__('Quantity')) ?></span>
                </label>
                <div class="control">
                    <input <?php if (!$_canChangeQty) { echo ' disabled="disabled"'; } ?>
                           id="bundle-option-<?= $block->escapeHtmlAttr($_option->getId()) ?>-qty-input"
                           class="input-text qty<?php if (!$_canChangeQty) { echo ' qty-disabled'; } ?>"
                           type="number"
                           name="bundle_option_qty[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                           data-selector="bundle_option_qty[<?= $block->escapeHtmlAttr($_option->getId()) ?>]"
                           value="<?= $block->escapeHtmlAttr($_defaultQty) ?>"/>
                </div>
            </div>
        </div>
    </div>
</div>




<script>
    require(['jquery', 'tippy'], function ($, tippy) {
        // Tippify all titled elements

$('#tippyclick_<?= $block->escapeHtmlAttr($_option->getId()) ?>').css("background-color", "yellow");
            tippy($('#tippyclick_<?= $block->escapeHtmlAttr($_option->getId()) ?>'), {
                delay: 100,
                arrow: true,
                arrowType: 'round',
                size: 'large',
                duration: 500,
                animation: 'scale',
                placement: 'left',
                interactive: true,
                trigger: 'click',
                theme: 'honeybee',
                content: '<strong>Bolded content</strong>'
            });

    });


</script>
