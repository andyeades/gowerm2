<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/** @var \Magento\ConfigurableProduct\Pricing\Render\FinalPriceBox $block */
/** @var \Magento\Framework\Pricing\Price\PriceInterface $priceModel */
$priceModel = $block->getPriceType('regular_price');
/** @var \Magento\Framework\Pricing\Price\PriceInterface $finalPriceModel */
$finalPriceModel = $block->getPriceType('final_price');
$idSuffix = $block->getIdSuffix() ? $block->getIdSuffix(): '';
$schema = ($block->getZone() == 'item_view') ? true: false;

$_product = $block->getPriceType('final_price')->getProduct();
$was_price = number_format((float)$_product->getWasPrice(), 2, '.', '');

echo ' <div style="display:none;">was_price_is_'.$_product->getSku()."|".$was_price.'</div>    ';

// TODO - Translations file surely makes more sense?

$rrp_from_label = 'RRP From';
$was_from_label = 'Was From';
$now_from_label = 'Now From';


if ($_product->getIsChild() == 1) {
    $rrp_from_label = 'RRP';
    $was_from_label = 'Was';
    $now_from_label = 'Now';

}

// Don't include anymore inline styles here please. Otherwise it's really going to turn into a nightmare when this needs to be sorted for another client.

// Speak to me if you want something changed

//



?>
<?php

$objectManager = \Magento\Framework\App\ObjectManager::getInstance();
$storeManager = $objectManager->get('Magento\Store\Model\StoreManagerInterface');
$currencyCode = $storeManager->getStore()->getCurrentCurrencyCode();
$currency = $objectManager->create('Magento\Directory\Model\CurrencyFactory')->create()->load($currencyCode);
$currencySymbol = $currency->getCurrencySymbol();

?>

<?php
// <div style="display:none;">theme_config_price</div>
?>
<?php if ($block->hasSpecialPrice() || $_product->getWasPrice() > 0) : ?>
    <span class="old-price sly-old-price">
        <?= /* @noEscape */
        $block->renderAmount(
            $priceModel->getAmount(), [
            'display_label'     => __($rrp_from_label),
            'price_id'          => $block->getPriceId('old-price-' . $idSuffix),
            'price_type'        => 'oldPrice',
            'include_container' => true,
            'skip_adjustments'  => true
        ]
        ); ?>
    </span>
<?php endif; ?>


<?php
// Outputting Divs we don't need is badddddd on a grid!

$outputWas = true;


$haswasClass = '';
if ($was_price > 0 && $_product->getIsChild() == 1) {
  //  $haswasClass = 'hide_was';
  //  $outputWas = false;
}
if ($was_price < 0.01) {
    $haswasClass = 'hide_was';
    $outputWas = false;
}

?>

<?php
// RJ Change - Outputting this on a grid is a biggggg no-no for div count - if it's not being used or seen - unless I am I missing something you need this for hidden

if ($outputWas != false) { ?>
    <span class="was-price <?= $haswasClass; ?> ">
    <span class="price-container price-was_price strikethrough">
            <span class="price-label"><?= $was_from_label; ?></span>
        <span class="was_price evwasprice" data-price-amount="<?= $was_price; ?>" class="price-wrapper "><span class="price"><?php echo $currencySymbol ?><?= $was_price; ?></span></span>
        </span>
    </span>

<?php } ?>

<span class="normal-price">

    <?= /* @noEscape */
    $block->renderAmount(
        $finalPriceModel->getAmount(), [
        'display_label'     => __($now_from_label),
        'price_id'          => $block->getPriceId('product-price-' . $idSuffix),
        'price_type'        => 'finalPrice',
        'include_container' => true,
        'schema'            => $schema,
    ]
    ); ?>
</span>


<?php if ($block->showMinimalPrice()) : ?><?php if ($block->getUseLinkForAsLowAs()) : ?>
    <a href="<?= $block->escapeUrl($block->getSaleableItem()->getProductUrl()) ?>" class="minimal-price-link">
        <?= /* @noEscape */
        $block->renderAmountMinimal() ?>
    </a>
<?php else : ?>
    <span class="minimal-price-link">
            <?= /* @noEscape */
            $block->renderAmountMinimal() ?>
        </span>
<?php endif ?><?php endif; ?>
