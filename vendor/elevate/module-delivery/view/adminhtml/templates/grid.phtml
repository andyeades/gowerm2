<style>
  .action-button {
    background-color: #eb5202;
    border-color:     #eb5202;
    color:            #ffffff;
    text-shadow:      1px 1px 0 rgba(0, 0, 0, 0.25);
    border:           1px solid;
    border-radius:    0;
    display:          inline-block;
    font-family:      'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size:        1.4rem;
    font-weight:      600;
    line-height:      1.36;
    padding:          0.6rem 1em 0.6rem;
    text-align:       center;
    vertical-align:   baseline;
    cursor:           pointer;
  }

  .action-button:hover {
    background-color: #ba4000;
    border-color:     #b84002;
    box-shadow:       0 0 0 1px #007bdb;
    color:            #ffffff;
    text-decoration:  none;
  }

  .actions-toolbar {
    padding-top: 20px;
  }

  .success-message {
    background-color: #79a22e;
  }

  .error-message {
    background-color: #ee7d7d;
  }

  .excluded td {
    background-color: #ee7d7d !important;
  }
  #order_data_hidden {
    display: none;
  }

  .problem-order-desc {
    margin-bottom: 15px;
  }

  .order-details-top {
    margin-bottom: 20px;
  }

  .order-items {
  }
  .order-item-shrt {
    margin-bottom: 5px;
  }
  .order-item-shrt-child {
    padding-left: 5px;
    padding-top: 5px;
  }
  .addresses-output {
    display: flex;
  }
  .addresses-output > div {
    flex: 0 1 auto;
    width: 50%;
  }
  .addresses-output > div:first-child {
    margin-right: 20px;
  }
  .addresses-output > div:last-child {
    margin-left: 20px;
  }

  .addresses-output .panel-heading {
    text-transform: capitalize;
  }
  .addresses-output .field-title {
    font-weight: 700;
  }

  .order-data-section {
    margin-bottom: 10px;
    display: flex;
  }
  .order-data-section .field-title {
    margin-right: 5px;
  }

  .order-data-section > div {
    flex: 0 1 auto;
  }
  .order-data-section .field-title {
    font-weight: 700;
  }

  .field-title {
    font-weight: 700;
  }

  .order-item-shrt {
    width: 100%;
    clear: both;
  }

  @media only screen and (min-width: 992px) {
    .orders-ship-tb-items {
      width: 450px;
    }
  }

  .loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
  }
  }

  .loading {
    position: fixed;
    z-index: 999;
    height: 2em;
    width: 100%;
    overflow: visible;
    margin: auto;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    display: none;
  }

  .loading:before {
    content: '';
    display: block;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
  }
  .loader-message {

    margin-top: 20px;
    color: #f3f3f3;
    width: 100%;
    margin: 0 auto;
    text-align: center;
    /* z-index: 99999990; */
    font-size: 30px;
    /* background: white; */
    z-index: 1;
    position: relative;
  }

</style>
<div id="message-block"></div>

<?php

$data = $this->doSomething();



?>

<div id="actions-toolbar" class="actions-toolbar">
  <div id="shipstuff" class="action-button">Ship Orders</div>

</div>
<div class="main-content">
  <?= $data; ?>
</div>

<div id="ajaxResponse"></div>

<div id="loading-overlay" class="loading">
  <div class="loader"></div>
  <div class="loader-message">Attempting to ship orders...</div>
</div>
<script type="text/javascript">
    require(["jquery"],function($) {

        jQuery('#shipstuff').on('click touchend', (function(){



            jQuery.ajax({
                url: "<?php echo $this->getUrl('elevate_delivery/test/test'); ?>?isAjax=true",
                type: 'POST',
                data: {
                    form_key: window.FORM_KEY,
                },
                dataType: 'json',
                beforeSend: function () {
                    jQuery('#loader').show();
                },
                success: function(response) {

                    jQuery('.loading').hide();
                    jQuery("#ajaxResponse").html(response);
                    console.log(response);
                    $("#page_order_state").val(response["data"]);
                    const keys = Object.keys(response);
                    const something = Object.values(response);
                    const more = Object.entries(response);

                    for (const somethin of something) {
                        var order_id = somethin.order_id;
                        var overall_success = parseInt(somethin.success);
                        var main_message = somethin.main_message;
                        var no_data = somethin.no_data;

                        if (no_data === 1) {
                            jQuery('#message-block').append('<div class="message message-error error" >' + main_message + '</div>');
                            break;
                        }

                        if (overall_success === 1) {
                            // Success
                            jQuery('#message-block').append('<div data-order_id="'+ order_id + '" class="message message-success success" >' + main_message + ' - '+ order_id + '</div>');
                            // Remove Order From List
                            jQuery('tr[data-order-id='+order_id+']').remove();
                        } else {
                            // Fail ?
                            jQuery('#message-block').append('<div data-order_id="'+ order_id + '" class="message message-error error" >' + main_message + ' - '+ order_id + '</div>');
                        }

                    }
                },
                error: function (xhr, status, errorThrown) {
                    jQuery('.loading').hide();
                    console.log(status);
                    console.log(xhr);
                    console.log(errorThrown);
                }
            });
        }));


    });
</script>
